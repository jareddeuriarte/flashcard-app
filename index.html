<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Flashcards â€” Offline & Local</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#121821; --ink:#e9eef5; --muted:#a9b6c6; --acc:#6aa5ff; --danger:#ff6a6a; --ok:#53d769; --warn:#ffcc00;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;}
    a{color:var(--acc)}
    .app{max-width:760px;margin:0 auto;padding:12px 12px 100px}
    header{position:sticky;top:0;background:linear-gradient(180deg, rgba(11,15,20,.98), rgba(11,15,20,.92));backdrop-filter:saturate(1.1) blur(6px);z-index:10;border-bottom:1px solid #1b2330}
    header .bar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:14px 12px}
    .title{font-weight:700;letter-spacing:.3px}
    .tabs{display:flex;gap:8px}
    .tab{padding:10px 14px;border:1px solid #213047;border-radius:999px;background:#0f1520;color:var(--muted);font-weight:600}
    .tab.active{background:var(--acc);color:#071221;border-color:transparent}

    .section{margin-top:16px}
    .card{background:var(--card);border:1px solid #1b2330;border-radius:var(--radius);padding:14px}
    .row{display:flex;gap:10px;align-items:center}
    .row.wrap{flex-wrap:wrap}
    .grid{display:grid;gap:10px}
    .grid.two{grid-template-columns: 1fr 1fr}
    @media (max-width:640px){.grid.two{grid-template-columns:1fr}}

    select, input, textarea, button{
      width:100%;padding:12px 12px;border-radius:12px;border:1px solid #233246;background:#0d1420;color:var(--ink);
      font-size:16px;outline:none
    }
    textarea{min-height:86px;resize:vertical}
    button{cursor:pointer;background:#152130;border:1px solid #213047}
    button.primary{background:var(--acc);color:#071221;border:none;font-weight:700}
    button.ghost{background:transparent;color:var(--muted);border:1px dashed #2b3a50}
    button.danger{background: #2a1010;border:1px solid #462222;color:#ffb1b1}

    .pill{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;background:#0e1622;border:1px solid #213047;color:var(--muted);font-size:14px}

    .list{display:flex;flex-direction:column;gap:8px}
    .list .item{background:#0c121b;border:1px solid #1a2331;border-radius:12px;padding:10px}

    .study-card{user-select:none;min-height:180px;border-radius:20px;display:flex;align-items:center;justify-content:center;text-align:center;padding:22px;font-size:20px;line-height:1.35;background:linear-gradient(180deg,#0e1724,#0b111b);border:1px solid #223046;box-shadow: inset 0 0 0 1px rgba(255,255,255,.03)}
    .study-ctr{display:flex;gap:10px;margin-top:10px}
    .study-ctr button{font-weight:700}

    .hint{color:var(--muted);font-size:13px}
    .spacer{height:10px}
    .footer{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(0deg, rgba(11,15,20,.98), rgba(11,15,20,.8));border-top:1px solid #1b2330;padding:10px;display:flex;gap:8px;justify-content:center}

    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#0e1622;border:1px solid #213047;color:var(--muted);font-size:12px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="row" style="gap:10px">
        <div class="title">ðŸ“š Flashcards</div>
        <span class="badge" id="deckCountBadge">0 decks</span>
        <span class="badge" id="cardCountBadge">0 cards</span>
      </div>
      <div class="tabs" role="tablist" aria-label="Sections">
        <button class="tab active" id="tab-manage" aria-selected="true">Manage</button>
        <button class="tab" id="tab-study" aria-selected="false">Study</button>
      </div>
    </div>
  </header>

  <main class="app">
    <!-- Manage Section -->
    <section class="section" id="manage-section" role="tabpanel" aria-labelledby="tab-manage">
      <div class="card grid" style="gap:14px">
        <div class="grid two">
          <div class="grid" style="gap:8px">
            <label class="pill">
              <span>Deck</span>
              <span class="sr-only">Choose deck</span>
            </label>
            <select id="deckSelect"></select>
            <div class="row" style="gap:8px">
              <button id="addDeckBtn" class="ghost">New deck</button>
              <button id="renameDeckBtn" class="ghost">Rename</button>
              <button id="deleteDeckBtn" class="danger">Delete deck</button>
            </div>
          </div>
          <div class="grid" style="gap:8px">
            <label class="pill">Quick Stats</label>
            <div class="row wrap">
              <span class="pill" id="statDeckCards">0 cards in deck</span>
              <span class="pill" id="statTotal">0 total cards</span>
            </div>
            <div class="row" style="gap:8px">
              <button id="exportBtn">Export JSON</button>
              <button id="importBtn">Import JSON</button>
              <input type="file" id="importFile" accept="application/json" class="sr-only" />
            </div>
          </div>
        </div>

        <div class="grid two">
          <div class="grid card" style="gap:8px">
            <strong>Add / Edit Card</strong>
            <input id="frontInput" placeholder="Front (question / word)" />
            <textarea id="backInput" placeholder="Back (answer / definition)"></textarea>
            <div class="row" style="gap:8px">
              <button class="primary" id="saveCardBtn">Save card</button>
              <button class="ghost" id="clearFormBtn">Clear</button>
            </div>
            <div class="hint">Tip: Use line breaks for multi-line answers. Everything saves to your browser's local storage.</div>
          </div>

          <div class="grid" style="gap:8px">
            <strong>Cards in Deck</strong>
            <div id="cardsList" class="list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Study Section -->
    <section class="section" id="study-section" hidden role="tabpanel" aria-labelledby="tab-study">
      <div class="card grid" style="gap:12px">
        <div class="grid two">
          <div class="grid" style="gap:8px">
            <label class="pill">Choose Deck</label>
            <select id="studyDeckSelect"></select>
            <div class="row" style="gap:8px">
              <button id="startStudyBtn" class="primary">Start session</button>
              <button id="shuffleBtn" class="ghost">Shuffle</button>
            </div>
            <div class="hint">Tap the card to flip. Use the buttons to go next.</div>
          </div>
          <div class="grid" style="gap:8px">
            <label class="pill">Session Stats</label>
            <div class="row wrap">
              <span class="pill" id="progressBadge">0 / 0</span>
              <span class="pill" id="flippedBadge">Front</span>
            </div>
          </div>
        </div>

        <div class="grid" style="gap:8px">
          <div id="studyCard" class="study-card" style="min-height:240px">No card loaded</div>
          <div class="study-ctr">
            <button id="flipBtn">Flip</button>
            <button id="prevBtn">Prev</button>
            <button id="nextBtn" class="primary">Next</button>
            <button id="markKnownBtn" class="ghost">Mark Known</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div class="footer">
    <button class="tab" id="footerManage">Manage</button>
    <button class="tab" id="footerStudy">Study</button>
  </div>

  <script>
  // ---- Data Layer ----
  const STORAGE_KEY = 'flashcards_v1';
  let state = loadState();

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        const parsed = JSON.parse(raw);
        // basic migrations
        if(!parsed.decks || !Array.isArray(parsed.decks)) throw new Error('bad');
        return parsed;
      }
    }catch(e){ console.warn('Resetting storage:', e); }
    // seed with demo
    const seed = {
      decks:[
        {id: id(), name:'My First Deck', cards:[
          {id:id(), front:'hola', back:'hello (Spanish)\nðŸ‘‹ Add your own cards!'},
          {id:id(), front:'ser vs. estar', back:'Both mean â€œto beâ€.\nser = essence / identity\nestar = state / condition'}
        ]}
      ]
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
    return seed;
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); refreshCounts(); }
  function id(){ return Math.random().toString(36).slice(2,10)+Date.now().toString(36).slice(-4); }

  // ---- DOM Helpers ----
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  function option(el, value, text){ const o=document.createElement('option'); o.value=value; o.textContent=text; el.appendChild(o); }
  function setHidden(el, hidden){ el.hidden = !!hidden; }

  // ---- Elements ----
  const deckSelect = $('#deckSelect');
  const studyDeckSelect = $('#studyDeckSelect');
  const cardsList = $('#cardsList');
  const frontInput = $('#frontInput');
  const backInput = $('#backInput');
  const saveCardBtn = $('#saveCardBtn');
  const clearFormBtn = $('#clearFormBtn');
  const addDeckBtn = $('#addDeckBtn');
  const renameDeckBtn = $('#renameDeckBtn');
  const deleteDeckBtn = $('#deleteDeckBtn');
  const exportBtn = $('#exportBtn');
  const importBtn = $('#importBtn');
  const importFile = $('#importFile');
  const statDeckCards = $('#statDeckCards');
  const statTotal = $('#statTotal');
  const deckCountBadge = $('#deckCountBadge');
  const cardCountBadge = $('#cardCountBadge');

  // Tabs
  const tabManage = $('#tab-manage');
  const tabStudy = $('#tab-study');
  const manageSection = $('#manage-section');
  const studySection = $('#study-section');
  const footerManage = $('#footerManage');
  const footerStudy = $('#footerStudy');

  // Study controls
  const startStudyBtn = $('#startStudyBtn');
  const shuffleBtn = $('#shuffleBtn');
  const studyCardEl = $('#studyCard');
  const flipBtn = $('#flipBtn');
  const prevBtn = $('#prevBtn');
  const nextBtn = $('#nextBtn');
  const markKnownBtn = $('#markKnownBtn');
  const progressBadge = $('#progressBadge');
  const flippedBadge = $('#flippedBadge');

  let editingId = null;

  // ---- Initialization ----
  renderDecks();
  renderCards();
  refreshCounts();

  // ---- Event Wiring ----
  tabManage.addEventListener('click', ()=>switchTab('manage'));
  tabStudy.addEventListener('click', ()=>switchTab('study'));
  footerManage.addEventListener('click', ()=>switchTab('manage'));
  footerStudy.addEventListener('click', ()=>switchTab('study'));

  deckSelect.addEventListener('change', ()=>{ renderCards(); syncStudyDeckSelect(); });
  saveCardBtn.addEventListener('click', saveCard);
  clearFormBtn.addEventListener('click', clearForm);
  addDeckBtn.addEventListener('click', addDeck);
  renameDeckBtn.addEventListener('click', renameDeck);
  deleteDeckBtn.addEventListener('click', deleteDeck);
  exportBtn.addEventListener('click', exportJSON);
  importBtn.addEventListener('click', ()=>importFile.click());
  importFile.addEventListener('change', handleImport);

  // study events
  startStudyBtn.addEventListener('click', startSession);
  shuffleBtn.addEventListener('click', ()=>{ if(currentSession){ shuffle(currentSession.order); updateStudyCard(); }});
  flipBtn.addEventListener('click', flipCard);
  studyCardEl.addEventListener('click', flipCard);
  prevBtn.addEventListener('click', ()=>advance(-1));
  nextBtn.addEventListener('click', ()=>advance(1));
  markKnownBtn.addEventListener('click', markKnown);

  // ---- Decks & Cards ----
  function getCurrentDeck(){
    const id = deckSelect.value; return state.decks.find(d=>d.id===id);
  }
  function renderDecks(){
    const current = deckSelect.value;
    deckSelect.innerHTML = '';
    studyDeckSelect.innerHTML = '';
    state.decks.forEach(d=>{
      option(deckSelect, d.id, d.name);
      option(studyDeckSelect, d.id, d.name);
    });
    if(current){ deckSelect.value=current; if(!deckSelect.value) deckSelect.selectedIndex=0; }
    else deckSelect.selectedIndex=0;
    studyDeckSelect.value = deckSelect.value;
  }
  function renderCards(){
    const deck = getCurrentDeck();
    cardsList.innerHTML = '';
    deck.cards.forEach(card=>{
      const item = document.createElement('div');
      item.className='item';
      const top = document.createElement('div');
      top.style.display='flex'; top.style.justifyContent='space-between'; top.style.gap='10px'; top.style.alignItems='center';
      const front = document.createElement('div'); front.textContent = card.front; front.style.fontWeight='700';
      const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='6px';
      const editBtn = document.createElement('button'); editBtn.textContent='Edit'; editBtn.onclick = ()=>{
        editingId = card.id; frontInput.value = card.front; backInput.value = card.back; frontInput.focus();
      }
      const delBtn = document.createElement('button'); delBtn.textContent='Delete'; delBtn.className='danger'; delBtn.onclick = ()=>{
        if(confirm('Delete this card?')){ deck.cards = deck.cards.filter(c=>c.id!==card.id); save(); renderCards(); }
      }
      actions.append(editBtn, delBtn);
      top.append(front, actions);
      const back = document.createElement('div'); back.textContent = card.back; back.style.whiteSpace='pre-wrap'; back.style.color='var(--muted)'; back.style.marginTop='6px';
      item.append(top, back);
      cardsList.appendChild(item);
    });
    statDeckCards.textContent = `${deck.cards.length} cards in deck`;
  }
  function saveCard(){
    const deck = getCurrentDeck();
    const front = frontInput.value.trim();
    const back = backInput.value.trim();
    if(!front || !back){ alert('Please fill front and back.'); return; }
    if(editingId){
      const card = deck.cards.find(c=>c.id===editingId);
      if(card){ card.front=front; card.back=back; }
      editingId = null;
    } else {
      deck.cards.push({id:id(), front, back});
    }
    save();
    renderCards();
    clearForm();
  }
  function clearForm(){ editingId=null; frontInput.value=''; backInput.value=''; }

  function addDeck(){
    const name = prompt('New deck name:');
    if(!name) return;
    state.decks.push({id:id(), name:name.trim(), cards:[]});
    save(); renderDecks(); renderCards(); refreshCounts();
  }
  function renameDeck(){
    const deck = getCurrentDeck(); if(!deck) return;
    const name = prompt('Rename deck:', deck.name); if(!name) return;
    deck.name = name.trim(); save(); renderDecks();
  }
  function deleteDeck(){
    const deck = getCurrentDeck(); if(!deck) return;
    if(state.decks.length===1){ alert('Keep at least one deck.'); return; }
    if(confirm(`Delete deck "${deck.name}" and its cards?`)){
      state.decks = state.decks.filter(d=>d.id!==deck.id);
      save(); renderDecks(); renderCards();
    }
  }

  function exportJSON(){
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'flashcards.json'; a.click();
    URL.revokeObjectURL(url);
  }
  function handleImport(e){
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(reader.result);
        if(!data || !Array.isArray(data.decks)) throw new Error('Invalid file');
        state = data; save(); renderDecks(); renderCards(); alert('Imported!');
      }catch(err){ alert('Import failed: '+err.message); }
    };
    reader.readAsText(file);
    importFile.value = '';
  }

  function refreshCounts(){
    const totalDecks = state.decks.length;
    const totalCards = state.decks.reduce((a,d)=>a+d.cards.length,0);
    deckCountBadge.textContent = `${totalDecks} deck${totalDecks===1?'':'s'}`;
    cardCountBadge.textContent = `${totalCards} card${totalCards===1?'':'s'}`;
    statTotal.textContent = `${totalCards} total cards`;
  }
  function syncStudyDeckSelect(){ studyDeckSelect.value = deckSelect.value; }

  // ---- Tabs ----
  function switchTab(which){
    const m = which==='manage';
    setHidden(manageSection, !m);
    setHidden(studySection, m);
    tabManage.classList.toggle('active', m);
    tabStudy.classList.toggle('active', !m);
    tabManage.setAttribute('aria-selected', m);
    tabStudy.setAttribute('aria-selected', !m);
    footerManage.classList.toggle('active', m);
    footerStudy.classList.toggle('active', !m);
  }

  // ---- Study Mode ----
  let currentSession = null; // { deckId, order:[idx], i, flipped:boolean, known:Set }
  function startSession(){
    const deckId = studyDeckSelect.value;
    const deck = state.decks.find(d=>d.id===deckId);
    if(!deck || deck.cards.length===0){ alert('Add some cards first.'); return; }
    const order = deck.cards.map((_,i)=>i);
    currentSession = { deckId, order, i:0, flipped:false, known:new Set() };
    updateStudyCard();
  }
  function updateStudyCard(){
    if(!currentSession){ studyCardEl.textContent = 'No card loaded'; progressBadge.textContent='0 / 0'; return; }
    const deck = state.decks.find(d=>d.id===currentSession.deckId);
    if(currentSession.i < 0) currentSession.i = 0;
    if(currentSession.i >= currentSession.order.length) currentSession.i = currentSession.order.length-1;
    const idx = currentSession.order[currentSession.i];
    const card = deck.cards[idx];
    studyCardEl.textContent = currentSession.flipped ? card.back : card.front;
    studyCardEl.style.whiteSpace = currentSession.flipped ? 'pre-wrap' : 'normal';
    progressBadge.textContent = `${currentSession.i+1} / ${currentSession.order.length}`;
    flippedBadge.textContent = currentSession.flipped ? 'Back' : 'Front';
  }
  function flipCard(){ if(!currentSession) return; currentSession.flipped = !currentSession.flipped; updateStudyCard(); }
  function advance(dir){ if(!currentSession) return; currentSession.i += dir; currentSession.flipped=false; updateStudyCard(); }
  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
  function markKnown(){
    if(!currentSession) return; const deck = state.decks.find(d=>d.id===currentSession.deckId);
    const idx = currentSession.order[currentSession.i];
    currentSession.known.add(idx);
    // Move known card to end so you cycle unknown first
    currentSession.order = [...currentSession.order.filter(i=>i!==idx), idx];
    advance(1);
  }

  // Keyboard shortcuts (desktop helpful)
  document.addEventListener('keydown', (e)=>{
    if(!currentSession) return;
    if([' ', 'Enter'].includes(e.key)){ e.preventDefault(); flipCard(); }
    if(e.key==='ArrowRight') advance(1);
    if(e.key==='ArrowLeft') advance(-1);
  });
  </script>
</body>
</html>
