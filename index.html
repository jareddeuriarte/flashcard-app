<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flashcards</title>
  <style>
    :root{
      --bg:#0f0f10;
      --panel:#151516;
      --ink:#e8e8eb;
      --muted:#a8a8b0;
      --line:#272729;
      --radius:6px;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial;}

    header{position:sticky;top:0;z-index:10;background:var(--bg);border-bottom:1px solid var(--line)}
    .bar{display:flex;align-items:center;justify-content:space-between;padding:10px 12px}
    .title{font-weight:700;letter-spacing:.2px}
    .hamburger{width:42px;height:42px;border:1px solid var(--line);background:transparent;color:var(--ink);
      border-radius:var(--radius);display:flex;align-items:center;justify-content:center;cursor:pointer}

    .app{max-width:720px;margin:0 auto;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);
      min-height:40vh;display:flex;align-items:center;justify-content:center;text-align:center;
      padding:20px;line-height:1.35;font-size:20px;user-select:none}
    .card.empty{color:var(--muted)}
    .hint{margin-top:8px;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:10px;margin-top:12px}
    button{appearance:none;border-radius:var(--radius);border:1px solid var(--line);
      background:#1a1a1b;color:var(--ink);padding:12px 14px;font-size:16px;cursor:pointer}
    button.primary{background:#202022}
    button:disabled{opacity:.5;cursor:not-allowed}
    .status{margin-top:10px;color:var(--muted);font-size:13px;display:flex;gap:12px;flex-wrap:wrap}

    /* Drawer */
    .drawer{position:fixed;top:0;left:0;right:0;bottom:0;display:none}
    .drawer.open{display:block}
    .scrim{position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.45)}
    .sheet{position:absolute;top:0;right:0;bottom:0;width:92vw;max-width:420px;background:var(--bg);
      border-left:1px solid var(--line);padding:14px;overflow:auto}
    .section{border:1px solid var(--line);border-radius:var(--radius);padding:12px;margin:10px 0;background:var(--panel)}
    .section h3{margin:0 0 10px 0;font-size:14px;letter-spacing:.2px}
    code{color:var(--ink)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .row.right{justify-content:flex-end}
    .seg button{padding:10px 12px;font-size:14px}
    .seg button.active{background:#262627}
    .small{font-size:12px;color:var(--muted)}
    .danger{color:var(--danger);border-color:#3a2323}

    @media (hover:none){
      button, .hamburger{min-height:44px}
    }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="title">Flashcards</div>
      <button id="hamburger" class="hamburger" aria-label="Open menu">☰</button>
    </div>
  </header>

  <main class="app">
    <div id="studyCard" class="card empty">Loading cards…</div>
    <div class="hint">Tap the card to flip. Swipe left/right to move.</div>

    <div class="controls">
      <button id="nextBtn" class="primary" disabled>Next →</button>
      <button id="shuffleBtn" disabled>Shuffle</button>
    </div>

    <div class="status">
      <div id="progress">0 / 0</div>
      <div id="side">Question</div>
      <div id="deckInfo"></div>
    </div>
  </main>

  <aside id="drawer" class="drawer" aria-hidden="true">
    <div id="scrim" class="scrim" tabindex="-1"></div>
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="menuTitle">
      <h2 id="menuTitle" style="margin:4px 0 8px 0;font-size:16px">Menu</h2>

      <section class="section">
        <h3>Study mode</h3>

        <div class="small">Cards are taken from <code>cards.json</code> in file order. Put newest cards at the top.</div>
        <div style="height:10px"></div>

        <div class="small">Mode</div>
        <div class="row seg" id="modeSeg" style="margin-top:6px">
          <button id="modeRecent" class="active" type="button">Recent</button>
          <button id="modeAll" type="button">All</button>
          <button id="modeOldest" type="button">Oldest</button>
        </div>

        <div style="height:10px"></div>
        <div class="small">Recent count</div>
        <div class="row seg" id="recentSeg" style="margin-top:6px">
          <button id="recent25" type="button">25</button>
          <button id="recent50" class="active" type="button">50</button>
          <button id="recent100" type="button">100</button>
        </div>

        <div class="hint" style="margin-top:10px" id="modeHint">Mode: Recent 50 (newest-first)</div>
      </section>

      <section class="section">
        <h3>Utilities</h3>
        <div class="row">
          <button id="reloadBtn" type="button">Reload cards</button>
          <button id="swapBtn" type="button">Swap Q/A</button>
        </div>
        <div class="hint" style="margin-top:8px" id="qaHint">Q/A: Spanish → English</div>
      </section>

      <section class="section">
        <h3>How this works</h3>
        <div class="hint">
          This app does <strong>not</strong> save anything in your browser.
          It loads cards from <code>cards.json</code> in the same folder as this HTML.
          Update workflow:<br>
          1) Ask ChatGPT to output vocab as JSON in the expected format<br>
          2) Paste into <code>cards.json</code> (newest at top)<br>
          3) Commit/push (or upload) both files<br>
          4) Refresh the page — same deck everywhere
        </div>
      </section>

      <div class="row right">
        <button id="closeDrawer" type="button">Close</button>
      </div>
    </div>
  </aside>

  <script>
    /*********************************************************************
     * FLASHCARDS — JSON-BACKED, LIGHTWEIGHT STUDY MODES
     * -------------------------------------------------------------------
     * SOURCE OF TRUTH: cards.json file order.
     * - Put NEW vocab at the TOP of cards.json (newest-first).
     * - Then we can implement simple modes without any extra metadata:
     *
     *   Mode = Recent N  -> take first N cards (top of file)
     *   Mode = All       -> take all cards
     *   Mode = Oldest N  -> take last N cards (bottom of file)
     *
     * Default requested:
     *   - mode = Recent
     *   - recentN = 50
     *
     * Also included:
     *   - Swap Q/A (Spanish→English vs English→Spanish) without storage
     *   - Swipe gestures: left=next, right=prev
     *********************************************************************/

    function $(sel){ return document.querySelector(sel); }

    // --- Study UI nodes ---
    var cardEl = $("#studyCard");
    var nextBtn = $("#nextBtn");
    var shuffleBtn = $("#shuffleBtn");
    var progressEl = $("#progress");
    var sideEl = $("#side");
    var deckInfoEl = $("#deckInfo");

    // --- Drawer UI nodes ---
    var drawer = $("#drawer");
    var hamburger = $("#hamburger");
    var scrim = $("#scrim");
    var closeDrawerBtn = $("#closeDrawer");

    // Mode controls
    var modeRecentBtn = $("#modeRecent");
    var modeAllBtn = $("#modeAll");
    var modeOldestBtn = $("#modeOldest");
    var recent25Btn = $("#recent25");
    var recent50Btn = $("#recent50");
    var recent100Btn = $("#recent100");
    var modeHintEl = $("#modeHint");

    // Utilities
    var reloadBtn = $("#reloadBtn");
    var swapBtn = $("#swapBtn");
    var qaHintEl = $("#qaHint");

    // ------------------
    // Runtime state
    // ------------------
    var deckTitle = "";

    // fullCards: what we loaded from cards.json (entire dataset)
    var fullCards = [];

    // activeCards: what we actually study right now (depends on mode)
    var activeCards = [];

    // order: indices into activeCards (used for shuffle)
    var order = [];

    // i: pointer into order
    var i = 0;

    // flipped: showing answer?
    var flipped = false;

    // reversed: swap Q/A (which side is the question?)
    // false = question is front (Spanish), answer is back (English)
    // true  = question is back (English), answer is front (Spanish)
    var reversed = false;

    // mode: "recent" | "all" | "oldest"
    var mode = "recent";

    // recentN: 25/50/100 (used for recent + oldest modes)
    var recentN = 50;

    // ---------------------------
    // Small helpers
    // ---------------------------
    function shuffleInPlace(arr){
      for(var j = arr.length - 1; j > 0; j--){
        var k = Math.floor(Math.random() * (j + 1));
        var tmp = arr[j]; arr[j] = arr[k]; arr[k] = tmp;
      }
      return arr;
    }

    function setActive(btn, on){
      if(!btn) return;
      if(on) btn.classList.add("active");
      else btn.classList.remove("active");
    }

    function updateModeUI(){
      setActive(modeRecentBtn, mode === "recent");
      setActive(modeAllBtn, mode === "all");
      setActive(modeOldestBtn, mode === "oldest");

      setActive(recent25Btn, recentN === 25);
      setActive(recent50Btn, recentN === 50);
      setActive(recent100Btn, recentN === 100);

      // Build a friendly label
      var label = "";
      if(mode === "all"){
        label = "Mode: All (shuffled)";
      } else if(mode === "recent"){
        label = "Mode: Recent " + recentN + " (newest-first)";
      } else {
        label = "Mode: Oldest " + recentN + " (from bottom)";
      }
      if(modeHintEl) modeHintEl.textContent = label;
    }

    function updateQaUI(){
      if(qaHintEl){
        qaHintEl.textContent = reversed ? "Q/A: English → Spanish" : "Q/A: Spanish → English";
      }
    }

    // ---------------------------
    // Core: build activeCards from fullCards
    // ---------------------------
    function rebuildActiveCards(){
      // fullCards is already in file order (newest at top, per your plan)
      var n = fullCards.length;

      if(mode === "all"){
        activeCards = fullCards.slice(); // all cards
      } else if(mode === "recent"){
        // first N cards from top
        activeCards = fullCards.slice(0, Math.min(recentN, n));
      } else if(mode === "oldest"){
        // last N cards from bottom
        var take = Math.min(recentN, n);
        activeCards = fullCards.slice(n - take, n);
      } else {
        // fallback
        activeCards = fullCards.slice(0, Math.min(recentN, n));
      }

      // Whenever we change the active set, reset session state
      rebuildOrder();
    }

    function rebuildOrder(){
      order = [];
      for(var idx=0; idx<activeCards.length; idx++){ order.push(idx); }
      i = 0;
      flipped = false;
      updateProgress();
    }

    // -------------------
    // Rendering
    // -------------------
    function updateStudyCard(){
      if(activeCards.length === 0){
        cardEl.classList.add("empty");
        cardEl.style.whiteSpace = "pre-wrap";
        cardEl.textContent = "No cards in this mode.\n\nTry Mode: All, or lower the Recent count.";
        nextBtn.disabled = true;
        shuffleBtn.disabled = true;
        sideEl.textContent = "Question";
        return;
      }

      var idx = order[i];
      var card = activeCards[idx];

      // Decide what question/answer text is (based on reversed flag)
      var questionText = reversed ? card.back : card.front;
      var answerText   = reversed ? card.front : card.back;

      cardEl.classList.remove("empty");
      cardEl.style.whiteSpace = flipped ? "pre-wrap" : "normal";
      cardEl.textContent = flipped ? answerText : questionText;

      sideEl.textContent = flipped ? "Answer" : "Question";
      nextBtn.disabled = false;
      shuffleBtn.disabled = false;
    }

    function updateProgress(){
      if(activeCards.length === 0){
        progressEl.textContent = "0 / 0";
        deckInfoEl.textContent = "";
        return;
      }

      // Show both: position and which slice you are studying
      progressEl.textContent = (i + 1) + " / " + order.length;

      var modePart = "";
      if(mode === "all") modePart = "All";
      else if(mode === "recent") modePart = "Recent " + Math.min(recentN, fullCards.length);
      else modePart = "Oldest " + Math.min(recentN, fullCards.length);

      var titlePart = deckTitle ? ("Deck: " + deckTitle + " · ") : "";
      deckInfoEl.textContent = titlePart + modePart;
    }

    // -------------------
    // Navigation
    // -------------------
    function nextCard(){
      if(!activeCards.length) return;
      i = (i + 1) % order.length;
      flipped = false;
      updateStudyCard();
      updateProgress();
    }

    function prevCard(){
      if(!activeCards.length) return;
      i = (i - 1 + order.length) % order.length;
      flipped = false;
      updateStudyCard();
      updateProgress();
    }

    function shuffleOrder(){
      shuffleInPlace(order);
      i = 0;
      flipped = false;
      updateStudyCard();
      updateProgress();
    }

    function flipCard(){
      if(!activeCards.length) return;
      flipped = !flipped;
      updateStudyCard();
    }

    // -------------------
    // Drawer open/close
    // -------------------
    function openDrawer(){
      drawer.classList.add("open");
      drawer.setAttribute("aria-hidden","false");
    }
    function closeDrawer(){
      drawer.classList.remove("open");
      drawer.setAttribute("aria-hidden","true");
    }
    hamburger.addEventListener("click", openDrawer);
    closeDrawerBtn.addEventListener("click", closeDrawer);
    scrim.addEventListener("click", closeDrawer);

    // -----------------------------
    // Load cards.json (fetch)
    // -----------------------------
    async function loadCards(opts){
      opts = opts || {};
      var url = "cards.json";
      if(opts.cacheBust){ url += "?v=" + Date.now(); }

      // UI while loading
      cardEl.classList.add("empty");
      cardEl.style.whiteSpace = "normal";
      cardEl.textContent = "Loading cards…";
      nextBtn.disabled = true;
      shuffleBtn.disabled = true;

      try{
        var res = await fetch(url, { cache: "no-store" });
        if(!res.ok){ throw new Error("HTTP " + res.status + " (" + res.statusText + ")"); }
        var data = await res.json();

        deckTitle = (data && typeof data.title === "string") ? data.title : "";

        if(!data || !Array.isArray(data.cards)){
          throw new Error("cards.json must include a { cards: [...] } array");
        }

        // Normalize
        fullCards = data.cards.map(function(c){
          return {
            front: String((c && c.front != null) ? c.front : ""),
            back:  String((c && c.back  != null) ? c.back  : "")
          };
        }).filter(function(c){
          return c.front.trim() !== "" || c.back.trim() !== "";
        });

        // IMPORTANT: We intentionally treat file order as \"newest-first\".
        // So Recent mode takes from TOP. Oldest mode takes from BOTTOM.
        rebuildActiveCards();

        updateModeUI();
        updateQaUI();
        updateStudyCard();
        updateProgress();
      }catch(err){
        fullCards = [];
        activeCards = [];
        rebuildOrder();
        updateStudyCard();
        updateProgress();
        cardEl.style.whiteSpace = "pre-wrap";
        cardEl.textContent = "Failed to load cards.json.\n\n" + err.message;
      }
    }

    // -------------------
    // Mode controls wiring
    // -------------------
    function applyMode(newMode){
      mode = newMode;
      rebuildActiveCards();
      updateModeUI();
      updateStudyCard();
      updateProgress();
      closeDrawer();
    }

    function applyRecentN(n){
      recentN = n;
      // Only affects recent/oldest modes, but safe to rebuild always
      rebuildActiveCards();
      updateModeUI();
      updateStudyCard();
      updateProgress();
      closeDrawer();
    }

    modeRecentBtn.addEventListener("click", function(){ applyMode("recent"); });
    modeAllBtn.addEventListener("click", function(){ applyMode("all"); });
    modeOldestBtn.addEventListener("click", function(){ applyMode("oldest"); });

    recent25Btn.addEventListener("click", function(){ applyRecentN(25); });
    recent50Btn.addEventListener("click", function(){ applyRecentN(50); });
    recent100Btn.addEventListener("click", function(){ applyRecentN(100); });

    // -------------------
    // Utilities wiring
    // -------------------
    reloadBtn.addEventListener("click", function(){
      loadCards({ cacheBust: true });
      closeDrawer();
    });

    swapBtn.addEventListener("click", function(){
      reversed = !reversed;
      flipped = false;
      updateQaUI();
      updateStudyCard();
      closeDrawer();
    });

  

    // -----------------------
    // Swipe gestures (mobile)
    // -----------------------
    var touchStartX = null;
    var touchStartY = null;
    var SWIPE_X_THRESHOLD = 50; // px
    var SWIPE_Y_MAX = 80;       // px

    cardEl.addEventListener("touchstart", function(e){
      if(!e.touches || e.touches.length !== 1) return;
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }, { passive: true });

    cardEl.addEventListener("touchend", function(e){
      if(touchStartX === null || touchStartY === null) return;
      var t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;

      var dx = t.clientX - touchStartX;
      var dy = t.clientY - touchStartY;

      touchStartX = null;
      touchStartY = null;

      if(Math.abs(dy) > SWIPE_Y_MAX) return;

      if(dx <= -SWIPE_X_THRESHOLD){
        nextCard();
      } else if(dx >= SWIPE_X_THRESHOLD){
        prevCard();
      }
    }, { passive: true });

    // Buttons + keyboard
    cardEl.addEventListener("click", flipCard);
    nextBtn.addEventListener("click", nextCard);
    shuffleBtn.addEventListener("click", shuffleOrder);

    document.addEventListener("keydown", function(e){
      if(e.key === " " || e.key === "Enter"){ e.preventDefault(); flipCard(); }
      else if(e.key === "ArrowRight"){ nextCard(); }
      else if(e.key === "ArrowLeft"){ prevCard(); }
      else if(e.key === "s" || e.key === "S"){ shuffleOrder(); }
      else if(e.key === "Escape"){ closeDrawer(); }
    });

    // -----------------------
    // Initialize (defaults)
    // -----------------------
    // Defaults requested: Recent 50, Spanish→English
    mode = "recent";
    recentN = 50;
    reversed = false;
    updateModeUI();
    updateQaUI();

    loadCards({ cacheBust: false });
  </script>
</body>
</html>
